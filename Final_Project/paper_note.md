## 方法概述

本文提出了一种名为SMITE（SEGMENT ME IN TIME）的视频分割方法，旨在通过少量参考图像实现视频中对象的灵活粒度分割。该方法利用预训练的文本到图像扩散模型，并结合额外的跟踪机制来确保跨帧的一致性。

## 问题定义

给定一个或多个图像作为参考，我们的目标是学习这些图像中对象的时间一致的分割，并将这些分割应用于目标视频中的同一类对象。具体来说，给定参考图像及其分割标注，我们希望生成一个能够在不同姿态、颜色或大小的视频中保持一致分割的模型。

## 模块说明

### 1. 参考图像分割

首先，我们使用参考图像的分割结果来优化文本嵌入。通过将参考图像和文本嵌入输入到SMITE模型中，我们获得图像分辨率的WAS（Weighted Accumulated Self-Attention）图。

$$
\mathcal{S}=\psi_{\theta}(\mathcal{I},\mathcal{T}) \quad,\quad \hat{Y}=argmax(\mathcal{S})
$$

其中，$\theta$表示模型的可学习参数，$\mathcal{S}$定义如公式(1)所示。

### 2. 网络微调

仅学习文本嵌入无法捕捉复杂的粒度。为了提取更多自定义的细粒度分割，我们需要微调现有的SD（Stable Diffusion）权重。我们分两个阶段进行优化：首先冻结模型，仅优化文本嵌入；然后解冻交叉注意力层，并与文本嵌入一起优化。

### 3. 时间一致性

为了增强时间一致性，我们在SMITE的膨胀UNet去噪器中使用时间注意力。我们还引入了一个基于跟踪的投票机制来确保分割的一致性。具体来说，我们使用CoTracker进行点跟踪，并将跟踪结果投影到注意力图上。

$$
\{(x_{t-\frac{w}{2}},y_{t-\frac{w}{2}}),...,(x_{t},y_{t}),...,(x_{t+\frac{w}{2}},y_{t+\frac{w}{2}})\}=\phi(\mathcal{P}(\mathcal{V}))
$$

其中，$\mathcal{P}$是跟踪器，$\phi$是缩放操作符，$w$表示滑动窗口的长度。

### 4. 低通正则化

为了确保分割在时间上的平滑过渡，我们使用低通滤波器对最终的分割结果进行正则化。

$$
\mathcal{E}_{\text{Reg}}=\left\|\omega(\mathcal{S})-\omega\left(\mathcal{S}_{\text{ref}}\right)\right\|_{1}
$$

其中，$\omega(S)=\mathcal{H}_{l}\odot DCT_{3D}(S)$，$DCT_{3D}$表示离散余弦变换，$\mathcal{H}_{l}$表示低通滤波器。

### 5. 空间-时间引导

我们的总能量函数通过扩散过程的反向传播来最小化，更新潜在表示以实现更一致的分割。

$$
\mathcal{E}_{\text{Total}}=\lambda_{\text{Tracking}}\cdot\mathcal{E}_{\text{Tracking}}+\lambda_{\text{Reg}}\cdot\mathcal{E}_{\text{Reg}}
$$

其中，$\lambda_{\text{Tracking}}$和$\lambda_{\text{Reg}}$分别是跟踪和参考损失函数的系数。

## 实验设置

### 数据集和基准

我们引入了一个名为SMITE-50的基准数据集，主要来源于Pexels。该数据集包含多粒度注释，涵盖了姿态变化和遮挡等视觉挑战场景。我们专注于三类：马、人脸和汽车，共41个视频。每个子集包括10个分割参考图像用于训练和密集注释的视频用于测试。

### 评估协议

我们使用标准的评估指标：平均交并比（mIOU）和轮廓准确率Fmeasure。我们使用少量参考图像对SMITE进行训练，然后在同一类别但不同对象的视频上进行评估。

## 结果和实验

### 定量比较

我们在SMITE-50数据集上进行了定量评估，结果表明我们的方法在所有类别和指标上都优于其他方法。具体来说，我们的方法在人脸、马和汽车类别的Fmeasure和mIOU上均表现出色。

### 定性比较

定性比较显示，我们的方法在分割质量和时间一致性方面表现最佳。与其他方法相比，我们的方法生成的边界更清晰，聚类更干净。

### 消融研究

我们进行了三项消融研究，证明了设计选择的有效性。具体来说，结合跟踪和低通正则化可以显著提高结果，交叉注意力优化也显著提高了分割质量。

### 用户研究

我们进行了用户研究，结果表明我们的方法在分割质量和运动一致性方面均优于其他方法。

## 结论

本文介绍了SMITE，一种支持视频中对象灵活粒度分割的技术。SMITE利用预训练的文本到图像扩散模型的语义知识，通过少量图像即可实现视频分割，并利用视频的时间一致性来保持分割的一致性。我们还收集了SMITE-50数据集，并通过定量和定性实验以及用户研究证明了我们方法的有效性。未来的研究可以进一步改进SMITE在处理小目标和低分辨率视频时的性能。